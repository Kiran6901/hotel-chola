{%- comment -%}
  CART TEMPLATE ‚Äî Zomato-Style
  Card-based layout with inline quantity stepper
{%- endcomment -%}

<div class="zomato-cart">
  {%- if cart.item_count > 0 -%}

    {%- comment -%} Header {%- endcomment -%}
    <div class="zc-header">
      <h2>Your Cart <span class="zc-header-count">({{ cart.item_count }} item{{ cart.item_count | pluralize: '', 's' }})</span></h2>
    </div>

    {%- comment -%} Cart Items {%- endcomment -%}
    <div class="zc-items">
      {%- for item in cart.items -%}
        <div class="zc-item">
          <a href="{{ item.url }}" class="zc-item-img-link">
            <img
              class="zc-item-img"
              src="{{ item.image | image_url: width: 200 }}"
              alt="{{ item.title | escape }}"
              loading="lazy"
            >
          </a>
          <div class="zc-item-info">
            <a href="{{ item.url }}" class="zc-item-name">
              {{ item.product.title }}
              {%- unless item.variant.title == 'Default Title' -%}
                <span class="zc-item-variant">{{ item.variant.title }}</span>
              {%- endunless -%}
            </a>
            <p class="zc-item-price">{{ item.price | money }}</p>
          </div>
          <div class="zc-item-right">
            <div class="zc-qty-stepper">
              <button
                data-cart-qty="minus"
                data-line-key="{{ item.key }}"
                data-current-qty="{{ item.quantity }}"
                aria-label="Decrease quantity"
              >‚àí</button>
              <span class="zc-qty-count">{{ item.quantity }}</span>
              <button
                data-cart-qty="plus"
                data-line-key="{{ item.key }}"
                data-current-qty="{{ item.quantity }}"
                aria-label="Increase quantity"
              >+</button>
            </div>
            <p class="zc-item-total">{{ item.line_price | money }}</p>
          </div>
        </div>
      {%- endfor -%}
    </div>

    {%- comment -%} Promo / Discount Code {%- endcomment -%}
    <div class="zc-promo" id="zc-promo-section">
      <p class="zc-promo-title">üè∑Ô∏è Apply Coupon</p>

      {%- comment -%} Default: input + apply button {%- endcomment -%}
      <div class="zc-promo-row" id="zc-promo-input-row">
        <input type="text" placeholder="Enter coupon code" class="zc-promo-input" id="zc-promo-input">
        <button class="zc-promo-btn" type="button" id="zc-promo-apply">Apply</button>
      </div>
      <p class="zc-promo-error" id="zc-promo-error" style="display:none;"></p>

      {%- comment -%} Applied state (hidden by default) {%- endcomment -%}
      <div class="zc-promo-applied" id="zc-promo-applied" style="display:none;">
        <p class="zc-promo-applied-label">‚úì <span id="zc-promo-code-display">GLIM</span> applied</p>
        <button class="zc-promo-remove" id="zc-promo-remove" type="button">Remove</button>
      </div>
    </div>

    {%- comment -%} Bill Details {%- endcomment -%}
    <div class="zc-bill">
      <h3>Bill Details</h3>
      <div class="zc-bill-row">
        <span>Item Total</span>
        <span>{{ cart.total_price | money }}</span>
      </div>
      <div class="zc-bill-row" id="zc-delivery-row">
        <span>Delivery Fee</span>
        <span id="zc-delivery-value">‚Çπ40</span>
      </div>
      {%- comment -%} Discount row (hidden until promo applied) {%- endcomment -%}
      <div class="zc-bill-row zc-discount-row" id="zc-discount-row" style="display:none;">
        <span>Discount (Free Delivery)</span>
        <span>‚àí‚Çπ40</span>
      </div>
      <div class="zc-bill-row zc-bill-total">
        <span>To Pay</span>
        <span id="zc-total-value">{{ cart.total_price | money_without_trailing_zeros }}</span>
      </div>
    </div>

    {%- comment -%} Savings badge (hidden until promo applied) {%- endcomment -%}
    <div class="zc-savings-badge" id="zc-savings-badge" style="display:none;">
      üéâ You saved ‚Çπ40 on this order!
    </div>

    {%- comment -%} Checkout {%- endcomment -%}
    <form action="/checkout" method="post">
      <button type="submit" name="checkout" class="zc-checkout-btn">
        Proceed to Checkout
      </button>
    </form>

  {%- else -%}

    {%- comment -%} Empty Cart {%- endcomment -%}
    <div class="zc-empty">
      <div class="zc-empty-icon">üõí</div>
      <p>Your cart is empty</p>
      <a href="/collections/all" class="zc-browse-btn">Browse Menu</a>
    </div>

  {%- endif -%}
</div>

{%- comment -%} GLIM Promo Code Logic {%- endcomment -%}
<script>
(function() {
  var applyBtn = document.getElementById('zc-promo-apply');
  var removeBtn = document.getElementById('zc-promo-remove');
  var inputRow = document.getElementById('zc-promo-input-row');
  var appliedRow = document.getElementById('zc-promo-applied');
  var promoInput = document.getElementById('zc-promo-input');
  var promoError = document.getElementById('zc-promo-error');
  var codeDisplay = document.getElementById('zc-promo-code-display');
  var deliveryValue = document.getElementById('zc-delivery-value');
  var discountRow = document.getElementById('zc-discount-row');
  var savingsBadge = document.getElementById('zc-savings-badge');
  var totalValue = document.getElementById('zc-total-value');

  if (!applyBtn) return;

  var cartTotal = {{ cart.total_price }} / 100;
  var DELIVERY_FEE = 40;

  function applyPromo() {
    var code = promoInput.value.trim().toUpperCase();
    if (!code) {
      promoError.textContent = 'Please enter a coupon code';
      promoError.style.display = 'block';
      return;
    }
    if (code !== 'GLIM') {
      promoError.textContent = 'Invalid coupon code';
      promoError.style.display = 'block';
      return;
    }
    // Apply
    promoError.style.display = 'none';
    inputRow.style.display = 'none';
    appliedRow.style.display = 'flex';
    codeDisplay.textContent = code;
    deliveryValue.innerHTML = '<span class="zc-strike">‚Çπ' + DELIVERY_FEE + '</span> <span class="zc-free">FREE</span>';
    discountRow.style.display = 'flex';
    savingsBadge.style.display = 'block';
    totalValue.textContent = '‚Çπ' + cartTotal;
  }

  function removePromo() {
    inputRow.style.display = 'flex';
    appliedRow.style.display = 'none';
    promoInput.value = '';
    promoError.style.display = 'none';
    deliveryValue.innerHTML = '‚Çπ' + DELIVERY_FEE;
    discountRow.style.display = 'none';
    savingsBadge.style.display = 'none';
    totalValue.textContent = '‚Çπ' + (cartTotal + DELIVERY_FEE);
  }

  applyBtn.addEventListener('click', applyPromo);
  if (removeBtn) removeBtn.addEventListener('click', removePromo);
  if (promoInput) {
    promoInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') applyPromo();
    });
    promoInput.addEventListener('input', function() {
      promoError.style.display = 'none';
    });
  }

  // Set initial total with delivery
  if (totalValue && cartTotal > 0) {
    totalValue.textContent = '‚Çπ' + (cartTotal + DELIVERY_FEE);
  }
})();
</script>

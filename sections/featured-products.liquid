{%- comment -%}
  FEATURED PRODUCTS SECTION
  Product grid using Shopify collection data with dynamic Liquid objects
{%- endcomment -%}

{%- assign featured_collection = section.settings.collection -%}
{%- assign products_to_show = section.settings.products_count | default: 6 -%}

<div class="food-display" id="food-display">
  {%- if section.settings.title != blank -%}
    <h2>{{ section.settings.title }}</h2>
  {%- endif -%}

  {%- if featured_collection != blank -%}
    {%- if featured_collection.products.size > 0 -%}
      <div class="food-display-list">
        {%- for product in featured_collection.products limit: products_to_show -%}
          {% render 'product-card', product: product %}
        {%- endfor -%}
      </div>

      {%- if featured_collection.products.size > products_to_show -%}
        <div class="view-all-container">
          <a href="{{ featured_collection.url }}" class="view-all-button">
            {{ section.settings.view_all_text | default: 'View All' }}
          </a>
        </div>
      {%- endif -%}
    {%- else -%}
      <div class="no-items-message">
        <p>{{ 'sections.featured_products.loading' | t }}</p>
      </div>
    {%- endif -%}
  {%- else -%}
    {%- comment -%} No collection selected â€” show all products {%- endcomment -%}
    {%- if collections['all'].products.size > 0 -%}
      <div class="food-display-list">
        {%- for product in collections['all'].products limit: products_to_show -%}
          {% render 'product-card', product: product %}
        {%- endfor -%}
      </div>

      {%- if collections['all'].products.size > products_to_show -%}
        <div class="view-all-container">
          <a href="/collections/all" class="view-all-button">
            {{ section.settings.view_all_text | default: 'View All' }}
          </a>
        </div>
      {%- endif -%}
    {%- else -%}
      <div class="no-items-message">
        <p>No products found. Add products to your store to see them here.</p>
      </div>
    {%- endif -%}
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Featured Products",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Top dishes near you"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from. Leave blank to show all products."
    },
    {
      "type": "range",
      "id": "products_count",
      "label": "Products to Show",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Button Text",
      "default": "View All"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Featured Products"
    }
  ]
}
{% endschema %}
